<?php 
if (count($this->groups) > 0) {
?>
<div dojoType="dijit.form.Form" class="formSearch" id="<?php echo $this->domPrefix?>formSearch" jsId="<?php echo $this->domPrefix?>formSearch" encType="multipart/form-data" action="" method="">
    <div class="formSearchInputs">
<?php 
    $i = 0;
    foreach ($this->groups as $group) :
        $params = (array) $group->attributes();
        $params = $params['@attributes'];
        $params['domId'] =  $this->domPrefix . '_search_';
        $params['i'] = $i;
        
        //$input = new $gType(true, 'fuu', 'ff', 'fff', '', null);
?>
        <div class="formSearchItemContainer">
            <div class="item">
                <label for="search" class="formSearchItemLabel"><?php echo $group->getAttribute('name') ?></label>
                <?php echo $this->action('index', $group->getAttribute('type'), 'elements', $params); ?>
                <input type="hidden" value="<?php echo $group->getAttribute('format') ?>" id="<?php echo $this->domPrefix . '_search_' . $i ?>_format" name="<?php echo $group->getAttribute('target') ?>_format" />
            </div>
<?php 
       $k = 0;
       if (count($group->children()) > 1) :
?>
           <div class="formSearchSelectors">
<?php
           foreach ($group->children() as $j => $element) :
               $eName = $element->getAttribute('name')
               ? $element->getAttribute('name')
               : $this->xml->getElements("@target='{$element->getAttribute('target')}'")[0]->getAttribute('name');
?>
                <div class="formSearchSelectorItem">
                    <input dojoType="dijit.form.RadioButton" id="<?php echo $this->domPrefix?>searchFields[<?php echo $i?>][<?php echo $k?>]" name="switchFields[<?php echo $i?>]" <?php if ($k == 0) echo 'checked="checked"' ?> value="<?php echo $element->getAttribute('target') ?>" type="radio" onClick="dijit.byId('<?php echo $this->domPrefix . '_search_' . $i?>').set('name', this.value)" />
                    <label for="<?php echo $element->getAttribute('target') ?>"><?php echo $eName ?></label>
                </div>
<?php 
            $k++;
            endforeach;
?>
            </div>
<?php 
        endif;
?>
        </div>
<?php 
        $i++;
    endforeach;
?>
    </div>
    <div class="formSearchSubmit">
        <input type="hidden" name="model" value="<?php echo $this->model ?>" />
        <input type="hidden" name="format" value="json" />
        <input type="hidden" name="storeType" value="query" />
        <input type="hidden" name="storeGrid" value="<?php echo $this->domPrefix ?>mainGrid" />
        <button type="submit" class="submit" dojoType="dijit.form.Button" iconClass="dijitIconSearch" id="<?=$this->domPrefix?>btnBuscar">Buscar</button>
    </div>

    <script type="dojo/method" event="onSubmit">
        if (this.validate()) {
            try{
                dojo.require('zwei.crud.AdmPortal');
                var crud = new zwei.crud.AdmPortal();
                crud.loadData(dijit.byId(this.id));
            }catch(e){alert(e.message)}
            return false;
        } else {
            alert('Por favor corrija los campos marcados.');
            return false;
        }
        return true;
    </script>
</div>
<?php 
}
?>
