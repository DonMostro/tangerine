<form dojoType="dijit.form.Form" target="ifrm_process" id="<?php echo $this->domPrefix?>form_<?php echo $this->mode?>" class="tabForm" jsId="<?php echo $this->domPrefix?>tabForm" name="<?php echo $this->domPrefix?>form_<?php echo $this->mode?>" encType="multipart/form-data"  action="<?php echo BASE_URL?>crud-request" method="post">
<?php 
$h = "style=\"background:#cccccc\"";
$i = 0;
$k = 1;
$tableWrapperClass = '';
$hidden = '';
if (count($this->tabs) > 1) :
    $tableWrapperClass = "settingsArea";
    foreach ($this->tabs as $tab) :
        $i++;
        if ($tab->getAttribute($this->mode) === "true") :
?>
        <a id="tab<?php echo $this->mode ?>_ctrl<?php echo $i?>" class="settings_tab" <?php echo $h ?> onclick="showtab(this.id, '<?php echo $this->domPrefix?>tab<?php echo $this->mode.$i?>')"><?php echo $tab->getAttribute('name') ?></a>
<?php 
        $h = '';
        endif;
    endforeach;
endif;
?>
<?php
$i=0;

foreach ($this->tabs as $tab) :
    $i++;
?>
    <div id="<?php echo $this->domPrefix.'Tab_'.$this->mode.$i?>" class="<?php echo $tableWrapperClass ?>" <?php echo $hidden ?>>
        <table>
<?php 
    $j=0;
    foreach ($tab as $element) :
        $j++;
        $params = (array) $element->attributes();
        $params = $params['@attributes'];
        $params['domId'] =  $this->domPrefix . "_{$this->mode}_";
        $params['i'] = $j;
        $params['target'] = "data[{$params['target']}]";
?>
            <tr>
                <th><label for="<?php echo $element->getAttribute('target')?>"><?php echo $element->getAttribute('name') ?></label></th>
                <td><?php echo $this->action('index', $element->getAttribute('type'), 'elements', $params); ?></td>
            </tr>
<?php 
    endforeach;
?>
        </table>
    </div>
<?php
endforeach;
?>
    <div class="brclear"></div>
    <input type="hidden" name="format" value="json" nosave="true" />
    <input type="hidden" name="action" value="<?php echo $this->mode?>" nosave="true" />
    <input type="hidden" name="model" value="<?php echo $this->model?>" nosave="true" />
    <input type="hidden" name="p" value="<?php echo $this->p ?>" nosave="true" />
<?php 
if ($this->mode == 'edit') :
    Debug::write($this->modelPrimary);
    foreach ($this->modelPrimary as $p) :
?>
    <input type="hidden" name="primary[<?php echo $p?>]" value="" nosave="true" />
<?php 
    endforeach;
endif;
?>
    <script type="dojo/method" event="onSubmit">
    if (this.validate()) {
        try {
            var form = new zwei.Form({
                dijitForm: this, 
                dijitDialog: dijit.byId('<?php echo $this->domPrefix?>dialog_<?php echo $this->mode ?>'),
                dijitDataGrid: dijit.byId('<?php echo $this->domPrefix?>dataGrid'),
                dijitFormSearch: dijit.byId('<?php echo $this->domPrefix?>formSearch'),
                iframe: dojo.byId('ifrm_process')
            });
            form.save();
        } catch (e) {
            alert(e.message);
        }
        
        return false;
    } else {
        alert('Por favor corrija los campos marcados.');
        return false;
    }
    return true;
    </script>
    <button dojoType="dijit.form.Button" id="<?php echo $this->domPrefix?>tabs_btn_save<?php echo $this->mode?>" type="submit" nosave="true"/>Guardar</button>
</form>